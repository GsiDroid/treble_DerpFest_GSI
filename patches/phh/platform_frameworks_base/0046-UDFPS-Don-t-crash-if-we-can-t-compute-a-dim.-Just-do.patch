From e1ef1a4d7cba8d2119932d986e614d49d7944873 Mon Sep 17 00:00:00 2001
From: BoNic <BoNio9527@gmail.com>
Date: Tue, 7 Nov 2023 14:52:20 +0800
Subject: [PATCH] UDFPS-Don-t-crash-if-we-can-t-compute-a-dim.-Just-do

---
 .../src/com/android/systemui/biometrics/UdfpsView.kt       | 7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

diff --git a/packages/SystemUI/src/com/android/systemui/biometrics/UdfpsView.kt b/packages/SystemUI/src/com/android/systemui/biometrics/UdfpsView.kt
index 6fa31568..7076f23d 100644
--- a/packages/SystemUI/src/com/android/systemui/biometrics/UdfpsView.kt
+++ b/packages/SystemUI/src/com/android/systemui/biometrics/UdfpsView.kt
@@ -276,11 +276,12 @@ class UdfpsView(
             }
         }
 
-        if (!bmFilesExist) {
-            throw FileNotFoundException("No brightness files under expected paths")
+        val dim = if (bmFilesExist) {
+            1.0 - Math.pow( (brightness / maxBrightness), 1/2.3);
+        } else {
+            0.0
         }
         // Assume HBM is max brightness
-        val dim = 1.0 - Math.pow( (brightness / maxBrightness), 1/2.3);
         Log.d("PHH-Enroll", "Brightness is $brightness / $maxBrightness, setting dim to $dim")
         if (hasAsusGhbm) {
             dimUpdate(dim.toFloat())
-- 
2.34.1

