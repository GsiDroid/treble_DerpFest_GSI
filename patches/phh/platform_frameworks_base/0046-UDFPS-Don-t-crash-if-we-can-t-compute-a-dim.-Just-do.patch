From 3c58fd0616e0e90c10a4aa01e7c665d14917afc9 Mon Sep 17 00:00:00 2001
From: KoysX <2685697179b@gmail.com>
Date: Thu, 26 Oct 2023 20:35:13 -0400
Subject: [PATCH] UDFPS-Don-t-crash-if-we-can-t-compute-a-dim.-Just-do

---
 .../src/com/android/systemui/biometrics/UdfpsView.kt       | 7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

diff --git a/packages/SystemUI/src/com/android/systemui/biometrics/UdfpsView.kt b/packages/SystemUI/src/com/android/systemui/biometrics/UdfpsView.kt
index f8f9cb50..6dee1a63 100644
--- a/packages/SystemUI/src/com/android/systemui/biometrics/UdfpsView.kt
+++ b/packages/SystemUI/src/com/android/systemui/biometrics/UdfpsView.kt
@@ -276,11 +276,12 @@ class UdfpsView(
             }
         }
 
-        if (!bmFilesExist) {
-            throw FileNotFoundException("No brightness files under expected paths")
+        val dim = if (bmFilesExist) {
+            1.0 - Math.pow( (brightness / maxBrightness), 1/2.3);
+        } else {
+            0.0
         }
         // Assume HBM is max brightness
-        val dim = 1.0 - Math.pow( (brightness / maxBrightness), 1/2.3);
         Log.d("PHH-Enroll", "Brightness is $brightness / $maxBrightness, setting dim to $dim")
         if (hasAsusGhbm) {
             dimUpdate(dim.toFloat())
-- 
2.42.0

