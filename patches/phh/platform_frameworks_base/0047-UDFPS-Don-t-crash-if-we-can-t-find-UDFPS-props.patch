From 4ebbe017a0a67dfb651b7b43468b5baea0e47719 Mon Sep 17 00:00:00 2001
From: BoNic <BoNio9527@gmail.com>
Date: Tue, 7 Nov 2023 14:54:38 +0800
Subject: [PATCH] UDFPS-Don-t-crash-if-we-can-t-find-UDFPS-props

---
 .../java/com/android/server/biometrics/AuthService.java   | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/services/core/java/com/android/server/biometrics/AuthService.java b/services/core/java/com/android/server/biometrics/AuthService.java
index d9cbb1f7..8194fbc2 100644
--- a/services/core/java/com/android/server/biometrics/AuthService.java
+++ b/services/core/java/com/android/server/biometrics/AuthService.java
@@ -1022,7 +1022,13 @@ public class AuthService extends SystemService {
                 getWorkaroundSensorProps(getContext());
 
         boolean isUdfps = !ArrayUtils.isEmpty(udfpsProps);
-        if(!isUdfps) udfpsProps = dynamicUdfpsProps();
+        if(!isUdfps) {
+            try {
+                udfpsProps = dynamicUdfpsProps();
+            } catch(Throwable t) {
+                Slog.e("PHH-Enroll", "Failed generating UDFPS props");
+            }
+        }
         isUdfps = !ArrayUtils.isEmpty(udfpsProps);
 
         if(udfpsProps.length > 0) {
-- 
2.34.1

